<!-- Extends the layout from /views/layout.html -->
{% extends 'layout.html' %}

<!-- Set the page title -->
{% block pageTitle %}
  {{ serviceName }}
{% endblock %}

<!-- For adding a breadcrumb -->
{% block beforeContent %}
{% endblock %}

{% block content %}

<style>
  .copy-tag {
    background-color: white;
    color: #005eb8;
    border: 1px solid #005eb8;
    transition: background-color 0.3s, color 0.3s;
  }

  .copy-tag:hover {
    background-color: #005eb8; 
    color: white;
    cursor: pointer;
  }

  /* NHS Design System green for copied state */
  .copy-tag.copied {
    background-color: #007f3b;
    color: white;
    border-color: #007f3b;
    cursor: default;
  }
</style>

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">
    <form action="search" method="post">

      <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
          <span class="nhsuk-caption-xl">Employing Authority details</span>
          <h1 class="nhsuk-heading-l" id="ea-name">Loading...</h1>
        </div>
      </div>

      <!-- Details Table -->
      <table id="search-details-table" role="table" class="nhsuk-table-responsive nhsuk-u-margin-top-4">
        <tbody class="nhsuk-table__body">

          <tr role="row">
            <td><strong>EA code</strong></td>
            <td id="ea-ref-text">Loading...</td>
            <td>
              <span class="nhsuk-tag copy-tag" role="button" tabindex="0" onclick="copyToClipboard('ea-ref-text', this)">Copy</span>
            </td>
          </tr>

          <tr role="row">
            <td><strong>Address</strong></td>
            <td id="address-text">Loading...</td>
            <td>
              <span class="nhsuk-tag copy-tag" role="button" tabindex="0" onclick="copyToClipboard('address-text', this)">Copy</span>
            </td>
          </tr>

          <tr role="row">
            <td><strong>Phone number</strong></td>
            <td id="phone-text">0333 0142884</td>
            <td>
              <span class="nhsuk-tag copy-tag" role="button" tabindex="0" onclick="copyToClipboard('phone-text', this)">Copy</span>
            </td>
          </tr>

        </tbody>
      </table>

      <!-- New Search Button -->
      <div class="button-container">
        <a href="search" class="nhsuk-button nhsuk-button--primary">New search</a>
      </div>

    </form>
  </div>
</div>

<script>
  function getQueryParams() {
    const params = {};
    location.search.substring(1).split('&').forEach(function(part) {
      if (!part) return;
      const item = part.split('=');
      const key = decodeURIComponent(item[0]);
      const value = decodeURIComponent(item[1]);
      params[key] = value;
    });
    return params;
  }

  function copyToClipboard(elementId, button) {
    const el = document.getElementById(elementId);
    if (!el) return;

    const tempEl = document.createElement('textarea');
    tempEl.value = el.innerText || el.textContent;
    document.body.appendChild(tempEl);
    tempEl.select();
    document.execCommand('copy');
    document.body.removeChild(tempEl);

    // Change button text and style
    button.textContent = 'Copied';
    button.classList.add('copied');

    // Reset after 2 seconds
    setTimeout(() => {
      button.textContent = 'Copy';
      button.classList.remove('copied');
    }, 2000);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const params = getQueryParams();

    const eaRef = params.ref || 'N/A';
    document.getElementById('ea-ref-text').textContent = eaRef;

    const name = params.name || 'N/A';
    document.getElementById('ea-name').textContent = name;

    const postcode = params.postcode || 'N/A';
    const fullAddress = `${name}<br>PO BOX 350<br>${postcode}`;
    document.getElementById('address-text').innerHTML = fullAddress;
  });
</script>

{% endblock %}
